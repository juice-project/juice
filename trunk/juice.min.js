var $jq=jQuery;(function($,window,undefined){var juice={_debugEnabled:false,_ready:false,_panels:[],_meta:[],version:"0.7",protocol:("https:"==document.location.protocol)?"https://":"http://",JsLoadFlags:[],popup_win:null,launchWinH:600,launchWinW:800,googleApiKey:"",path:""};var base=$("base").attr("href")||"";var path=$("script[src*=/juice.js]").attr("src").replace("/juice.js","/")||"";juice.path=base+path;juice.setDebug=function(state){juice._debugEnabled=state};juice.findMeta=function(id,selector,attribute,filter){if($.isFunction(attribute)){filter=attribute;attribute=null}var i=0;var values=[];$(selector).each(function(){var val;if(attribute){val=$(this).attr(attribute)}else{if($(this).size()>0){val="";var contents=$(this).contents();contents.each(function(){if(this.nodeType==3){val+=this.nodeValue}})}}if($.isFunction(filter)&&val!==undefined){val=filter(val,id)}if(val!==undefined){values[i++]=val}});if(values.length>0){juice.setMeta(id,values)}};juice.setMeta=function(id,arg){var val;if($.isFunction(arg)){val=arg(id)}else{val=arg}if(val){var values=$.juice.toArray(val);juice._meta[id]={values:values}}};juice.hasMeta=function(id){if(id){var meta=juice._meta[id];if(meta!=null){return meta.values.length>0}}else{for(var i in juice._meta){if(juice._meta[i]!=null){return true}}}return false};juice.getMeta=function(id,index){var meta=juice._meta[id];if(meta!=null){return meta.values[index==null?0:index]}return null};juice.deleteMeta=function(id){if(juice._meta[id]){juice._meta[id]=null}};juice.getMetaValues=function(id){var meta=juice._meta[id];if(meta!=null){return meta.values}return null};juice.debugMeta=function(){for(var i in juice._meta){var meta=juice._meta[i];if(meta.values.length>0){if(meta.values.length>1){juice.debugOutln(i+": ["+meta.values.join(",")+"]")}else{juice.debugOutln(i+": "+meta.values[index==null?0:index])}}else{juice.debugOutln("Meta "+i+": not set")}}};juice.addPanel=function(panel){juice._panels[juice._panels.length]=panel};juice.debugOutln=function(text){if(juice._debugEnabled){if($("#JuiceDebug").length==0){$("body").append('<div id="JuiceDebug" style="clear: both; z-index: 5000; position: relative; text-align: left; color: #000000; background: #ffffff; font-size: 1.25em;"</div>')}$("#JuiceDebug").append(text+"<br/>")}};juice.addToPanel=function(sel){for(var i=0;i<juice._panels.length;i++){var panel=juice._panels[i];if((sel.defPanel==null&&!panel.shared)||(sel.defPanel!=null&&panel.panelId!=sel.defPanel)){continue}panel.add(sel)}};juice.enableOnPanel=function(sel,pos){for(var i=0;i<juice._panels.length;i++){var panel=juice._panels[i];if((sel.defPanel==null&&!panel.shared)||(sel.defPanel!=null&&panel.panelId!=sel.defPanel)){continue}panel.enable(sel,pos)}};juice.launchWin=function(uri,type,arg1,arg2){switch(type){case"current":location.href=uri;break;case"overlay":juice.launchOverlayWin(arg1,arg2);break;case"iframe":juice.launchIframeWin(uri,arg1);break;case"iframe-overlay":var target=juice.launchOverlayWin(arg1,arg2);juice.launchIframeWin(uri,target);break;case"new":default:juice.launchExternalWin(uri);break}};juice.launchOverlayWin=function(content,hdrContent){if(content instanceof JuiceInsert){content=content._container}$("body").append('<div id="juiceOverlayMask" class="juiceOverlayMask"></div>');$("body").append('<div id="juiceOverlay" class="juiceOverlay" role="dialog" aria-labelledby="juiceovTitle" />');$("#juiceOverlay").append('<h2 id="juiceovTitle" class="juiceOverlayTitle" tabindex="0" />'+content);if(hdrContent){$("#juiceOverlay h2").append(hdrContent)}$("#juiceOverlay h2").append('<a href="javascript:void()" id="juiceovExitClick"><img alt="close lightbox" src="http://talis-rjw.s3.amazonaws.com/PrismDev/close_icon.png" class="juiceovOverlayExitClick" /></a>');var overlayRemove=function(){$("#juiceOverlay").remove();$("#juiceOverlayMask").remove()};$("#juiceovExitClick").click(overlayRemove);$(document).keydown(function(e){if(e.keyCode==27){overlayRemove()}})};juice.launchExternalWin=function(uri){if(juice.popup_win&&!juice.popup_win.closed){juice.popup_win.close()}juice.popup_win=window.open(uri,"Juice","width="+juice.launchWinW+",height="+juice.launchWinH+",toolbar=yes,location=yes,directories=yes,status=yes,menubar=yes,scrollbars=yes,copyhistory=yes,resizable=yes");if(window.focus){juice.popup_win.focus()}};juice.launchIframeWin=function(uri,insert){var target=insert;if(insert instanceof JuiceInsert){insert.show();target=insert.getInsertObject()}if(target){var frame=document.createElement("iframe");frame.id="juiframe";frame.src=uri;frame.height=target.height();frame.width=target.width();frame.scrolling="auto";target.append(frame)}};juice.runscript=function(id,src){$("#"+id).remove();var cont='<script id="'+id+'" src="'+src+'" type="text/javascript"><\/script>';$(document).prepend(cont)};juice.ready=juice.onAllLoaded=function(func){if(juice.isGoogleApiLoaded()&&juice.isJsLoaded()){func()}else{setTimeout(function(){juice.ready(func)},5)}};juice.loadExtensions=function(){var args=Array.prototype.slice.call(arguments);args=args.slice(0,args.length);for(var i=0;i<args.length;i++){if(args[i].indexOf(".js")==-1){args[i]=args[i]+".js"}juice.loadJs(juice.path+"extensions/"+args[i],"")}};juice.loadJs=function(target,pathPrefix,onLoadEvent){var file=juice._absoluteUri(target,pathPrefix);if(juice.findJs(file)){if(onLoadEvent){onLoadEvent()}return}juice._loadFile(file,"js",onLoadEvent)};juice.loadCss=function(target,pathPrefix){juice._loadFile(juice._absoluteUri(target,pathPrefix),"css")};juice._loadFile=function(file,type,evnt){if(type=="js"){var head=document.getElementsByTagName("head")[0];var ins=document.createElement("script");evnt=evnt||$.noop;ins.type="text/javascript";ins.src=file;juice.JsLoadFlags[juice.JsLoadFlags.length]={name:file,loaded:false,type:"script"};ins.onreadystatechange=function(){if(ins.readyState=="loaded"||ins.readyState=="complete"){evnt();juice.jsOnLoadEvent(file)}};ins.onload=function(){evnt();juice.jsOnLoadEvent(file)};head.insertBefore(ins,head.firstChild)}else{if(type=="css"){$("head").prepend('<link type="text/css" rel="stylesheet" href="'+file+'" />')}}};juice._absoluteUri=function(file,pathPrefix){if(juice._strBeginsWith(file,"http://")||juice._strBeginsWith(file,"https://")||juice._strBeginsWith(window.location.protocol,"file:")){return file}if(juice._strBeginsWith(file,"/")){if(!pathPrefix){pathPrefix=""}else{pathPrefix="/"+pathPrefix}return window.location.protocol+"//"+window.location.host+pathPrefix+file}else{if(!pathPrefix){pathPrefix=""}else{pathPrefix=pathPrefix+"/"}var ret=window.location.protocol+"//"+window.location.host;var path=document.location.pathname;if(juice._strEndsWith(path,"/")){path=path.substr(0,path.length-1)}var locationBits=path.split("/");for(var i=0;i<locationBits.length-1;i++){ret+=locationBits[i]+"/"}return ret+pathPrefix+file}};juice.findJs=function(file){var script=$("script[src*="+juice.urlRoot(file)+"]");if(script.length>0){return true}return false};juice.urlRoot=function(url){if(url.indexOf("#")!=-1){url=url.substring(0,url.indexOf("#"))}if(url.indexOf("?")!=-1){url=url.substring(0,url.indexOf("?"))}return url};juice.jsOnLoadEvent=function(name){var loadFlags=juice.JsLoadFlags;for(var i=0;i<loadFlags.length;i++){if(name==loadFlags[i].name){loadFlags[i].loaded=true;break}}};juice.onJsLoaded=function(func){if(juice.isJsLoaded()){func()}else{setTimeout(function(){juice.onJsLoaded(func)},10)}};juice.isJsLoaded=function(){return !juice.JsNotLoaded().length};juice.JsNotLoaded=function(){var ret=[];var loadFlags=juice.JsLoadFlags;for(var i=0;i<loadFlags.length;i++){if(!loadFlags[i].loaded){ret[ret.length]=loadFlags[i].name}}return ret};juice.loadGoogle_jsapi=function(){if(window.google==undefined){var key=juice.googleApiKey;if(key!=""){key="key="+key+"&"}juice.loadJs(juice.protocol+"www.google.com/jsapi?"+key,"")}};juice.loadGoogleApi=function(api,ver,args){if(!juice.googleApiLoaded(api)){juice.JsLoadFlags[juice.JsLoadFlags.length]={name:api,loaded:false,type:"google"};juice._loadGoogleApi(api,ver,args)}};juice._loadGoogleApi=function(api,ver,args){juice.loadGoogle_jsapi();if(window.google!=undefined){window.google.load(api,ver,{callback:function(){juice.jsOnLoadEvent(api)}})}else{setTimeout(function(){juice._loadGoogleApi(api,ver,args)},20)}};juice.onGoogleApiLoaded=function(func){if(juice.isGoogleApiLoaded()){func()}else{setTimeout(function(){juice.onGoogleApiLoaded(func)},5)}};juice.isGoogleApiLoaded=function(){var loadFlags=juice.JsLoadFlags;for(var i=0;i<loadFlags.length;i++){if(loadFlags[i].type=="google"&&!loadFlags[i].loaded){return false}}return true};juice.googleApiLoaded=function(api){var ret=[];var loadFlags=juice.JsLoadFlags;for(var i=0;i<loadFlags.length;i++){if(loadFlags[i].type=="google"&&loadFlags[i].name==api){return true}}return false};juice.nums="0123456789";juice.lc="abcdefghijklmnopqrstuvwxyz";juice.uc="ABCDEFGHIJKLMNOPQRSTUVWXYZ";juice.isVal=function(value,val){if(value==""){return true}for(i=0;i<value.length;i++){if(val.indexOf(value.charAt(i),0)==-1){return false}}return true};juice.isnumser=function(value){return $.juice.isVal(value,$.juice.nums)};juice.isLower=function(value){return $.juice.isVal(value,j$.juice.lc)};juice.isUpper=function(value){return $.juice.isVal(value,$.juice.uc)};juice.isAlpha=function(value){return $.juice.isVal(value,$.juice.lc+$.juice.uc)};juice.isAlphanum=function(value){return $.juice.isVal(value,$.juice.lc+$.juice.uc+$.juice.nums)};juice.stringToAlphnumAray=juice.stringToAlphnumArray=function(str){var items=[];var count=0;var raw=$.juice.stringToArray(str,",.:;");for(j=0;j<raw.length;j++){if($.juice.isAlphanum(raw[j])){items[count++]=raw[j]}}return items};juice.stringToArray=function(str,extras){var seps=" s\t\n\f\r"+extras.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");var replace=new RegExp("["+seps+"]+","mg");str=$.trim(str.replace(replace," "));var spl=str.split(" ");return spl};juice.toArray=function(data){var items=[];if(!data){return items}else{if($.isArray(data)){return data}else{if(typeof data=="string"){items[0]=data}else{if(!data[0]){items[0]=data}else{items=data}}}}return items};juice.updateArray=function(first,second){var ret=first;if(second){for(var i in second){ret[i]=second[i]}}return ret};juice.setCookie=function(name,value,minutes,hours,days,path,domain,secure){var cookie_string=name+"="+escape(value);if(minutes){if(!hours){hours=0}if(!days){days=0}var date=new Date();date.setTime(date.getTime()+((((days*24*60*60)+(hours*60*60)+(minutes*60))*1000)));var expires="; expires="+date.toGMTString();cookie_string+="; expires="+expires.toGMTString()}if(path){cookie_string+="; path="+escape(path)}if(domain){cookie_string+="; domain="+escape(domain)}if(secure){cookie_string+="; secure"}document.cookie=cookie_string};juice.getCookie=function(name){var results=document.cookie.match("(^|;) ?"+name+"=([^;]*)(;|$)");if(results){return(unescape(results[2]))}return null};juice.deleteCookie=function(name){var cookie_date=new Date();cookie_date.setTime(cookie_date.getTime()-1);document.cookie=name+="=; expires="+cookie_date.toGMTString()};juice._strBeginsWith=function(str,target){return(str.match("^"+target)==target)};juice._strEndsWith=function(str,target){return(str.match(target+"$")==target)};window.juice=jQuery.juice=$.juice=juice;function JuiceInsert(container,insertPoint,insertType){this._container=container;this._insertPoint=insertPoint;this._insertType=insertType;this.shown=[];this.insertObjects=[];this.inserts=$(this._insertPoint).length;for(var i=0;i<this.inserts;i++){this.shown[i]=false;this.insertObjects[i]=null}}JuiceInsert.prototype.showAll=function(){for(var i=0;i<this.inserts;i++){this.show(i)}};JuiceInsert.prototype.show=function(pos){pos=pos||0;var This=this;$(this._insertPoint).each(function(i){if(i==pos&&!This.shown[i]){var ins=jQuery(This._container);var target=jQuery(this);This.insertObjects[i]=ins;switch(This._insertType){case"after":target.after(ins);break;case"before":target.before(ins);break;case"prepend":target.prepend(ins);break;case"replace":target.replaceWith(ins);break;case"append":default:target.append(ins);break}This.shown[i]=true}})};JuiceInsert.prototype.getInsertObject=function(pos){return this.insertObjects[pos||0]};JuiceInsert.prototype.remove=function(pos){pos=pos||0;if(this.shown[pos]){this.insertObjects[pos].remove();this.insertObjects[pos]=null;this.shown[pos]=false}};window.JuiceInsert=jQuery.juice.insert=JuiceInsert;function JuiceProcess(id,initFunc,selectFunc,insert,ju){this._ready=false;if(arguments.length){this.init(id,initFunc,selectFunc,insert,ju)}}JuiceProcess.prototype.initAndStartup=function(id,initFunc,selectFunc,insert,ju){this.init(id,initFunc,selectFunc,insert,ju);this.startup()};JuiceProcess.prototype.init=function(id,initFunc,selectFunc,insert,ju){this.ProcessId=id;this._startFunc=initFunc;this._selectFunc=selectFunc;this._insert=insert;this._juice=ju;this._ready=true};JuiceProcess.prototype.initFunc=function(v){if(v!=null){this._initFunc=v}return this._initFunc};JuiceProcess.prototype.insert=function(v){if(v!=null){this._insert=v}return this._insert};JuiceProcess.prototype.startupWhenReady=function(){if(this._ready){this.startup()}else{var This=this;setTimeout(function(){This.startupWhenReady()},5)}};JuiceProcess.prototype.startup=function(){var This=this;setTimeout(function(){This._startup()},2)};JuiceProcess.prototype._startup=function(){if(this._startFunc){this._startFunc(this)}else{this.enable()}};_JXSPA=[];JuiceProcess.prototype.callbackArrayPos=-1;JuiceProcess.prototype.jsonCallBackPrefix=function(methodName){var ret="_JXSPA["+this.getCallBackPos()+"]";if(methodName){ret+="."+methodName}return encodeURIComponent(ret)};JuiceProcess.prototype.getCallBackPos=function(){if(this.callbackArrayPos==-1){_JXSPA[_JXSPA.length]=this;for(var i=0;i<_JXSPA.length;i++){if(_JXSPA[i]==this){break}}this.callbackArrayPos=i}return this.callbackArrayPos};JuiceProcess.prototype.showInsert=function(pos){if(this._insert){this._insert.show(pos)}};JuiceProcess.prototype.getInsertObjects=function(){return this._insert.insertObjects||[]};JuiceProcess.prototype.getInsertObject=function(pos){return this._insert.getInsertObject(pos)||null};JuiceProcess.prototype.insertCount=function(){return this._insert.inserts||0};JuiceProcess.prototype.enable=function(){};window.JuiceProcess=jQuery.juice.process=JuiceProcess;function JuiceSelectProcess(id,iconSrc,selText,initFunc,selectFunc,insert,ju,defPanel){this._ready=false;if(arguments.length){this.init(id,iconSrc,selText,initFunc,selectFunc,insert,ju,defPanel)}}JuiceSelectProcess.prototype=new JuiceProcess();JuiceSelectProcess.prototype.constructor=JuiceSelectProcess;JuiceSelectProcess.superclass=JuiceProcess.prototype;JuiceSelectProcess.prototype.init=function(id,iconSrc,selText,initFunc,selectFunc,insert,ju,defPanel){this.selText=selText;this.iconSrc=iconSrc;this.defPanel=defPanel;JuiceSelectProcess.superclass.init.call(this,id,initFunc,selectFunc,insert,ju);this.addToIconWin();this.startup()};JuiceSelectProcess.prototype.addToIconWin=function(){this._juice.addToPanel(this)};JuiceSelectProcess.prototype.enable=function(pos){this._juice.enableOnPanel(this,pos)};JuiceSelectProcess.prototype.getSelectFunction=function(i){i=i||0;var pos=this.getCallBackPos();return(function(){_JXSPA[pos]._selectFunc[i]})};window.JuiceSelectProcess=jQuery.juice.selectProcess=JuiceSelectProcess;function JuicePanel(insertDiv,panelId,startClass,liveClass,showFunc){this.init(insertDiv,panelId,startClass,liveClass,showFunc)}JuicePanel.prototype.init=function(insertDiv,panelId,startClass,liveClass,showFunc){this.liveClass=liveClass;this.startClass=startClass;this.inserted=false;this.shown=false;this.shared=true;this.panelId=panelId;this._insertDiv=insertDiv;this._showFunc=showFunc};JuicePanel.prototype.insert=function(){if(!this.inserted){this._insertDiv.showAll();this.inserted=true}};JuicePanel.prototype.show=function(){if(jQuery.isFunction(this._showFunc)&&!this.shown){this._showFunc();this.shown=true}};JuicePanel.prototype.add=function(sel){this.insert();this.show();var objects=this._insertDiv.insertObjects;for(var i=0;i<objects.length;i++){var id=this.makeId(sel,i);var htm='<img title="'+sel.selText+'" id="'+id+'" class="'+this.startClass+'" src="'+sel.iconSrc+'" />';objects[i].append(htm)}sel.insert(this._insertDiv)};JuicePanel.prototype.enable=function(sel,pos){var func=sel.getSelectFunction(pos);var id=this.makeId(sel,pos);var classes=this.startClass.split(" ");for(var i=0;i<classes.length;i++){$("#"+id).removeClass(classes[i])}classes=this.liveClass.split(" ");for(var i=0;i<classes.length;i++){$("#"+id).addClass(classes[i])}$("#"+id).click(func)};JuicePanel.prototype.makeId=function(sel,pos){pos=pos||0;return this.panelId+"-"+sel.processId+"-"+pos};window.JuicePanel=jQuery.juice.panel=JuicePanel})(jQuery,window);