var $jq=jQuery;(function($jq,window,undefined){function _Juice(opts){$jq.extend(this,{_debugEnabled:false,_ready:false,_panels:[],_meta:[],version:"0.7",protocol:("https:"==document.location.protocol)?"https://":"http://",JsLoadFlags:[],popup_win:null,launchWinH:600,launchWinW:800,gapLoadFlags:[],googleApiKey:"",_googleLoadFlag:false},opts)}_Juice.prototype.setDebug=function(state){this._debugEnabled=state};_Juice.prototype.findMeta=function(id,selector,attribute,filter){if($jq.isFunction(attribute)){filter=attribute;attribute=null}var i=0;var values=[];$jq(selector).each(function(){var val;if(attribute){val=$jq(this).attr(attribute)}else{if($jq(this).size()>0){val="";var contents=$jq(this).contents();contents.each(function(){if(this.nodeType==3){val+=this.nodeValue}})}}if($jq.isFunction(filter)&&val!==undefined){val=filter(val,id)}if(val!==undefined){values[i++]=val}});if(values.length>0){this.setMeta(id,values)}};_Juice.prototype.setMeta=function(id,arg){var val;if($jq.isFunction(arg)){val=arg(id)}else{val=arg}if(val){var values=$jq.juice.toArray(val);this._meta[id]={values:values}}};_Juice.prototype.hasMeta=function(id){if(id){var meta=this._meta[id];if(meta!=null){return meta.values.length>0}}else{for(var i in this._meta){if(this._meta[i]!=null){return true}}}return false};_Juice.prototype.getMeta=function(id,index){var meta=this._meta[id];if(meta!=null){return meta.values[index==null?0:index]}return null};_Juice.prototype.deleteMeta=function(id){if(this._meta[id]){this._meta[id]=null}};_Juice.prototype.getMetaValues=function(id){var meta=this._meta[id];if(meta!=null){return meta.values}return null};_Juice.prototype.debugMeta=function(){for(var i in this._meta){var meta=this._meta[i];if(meta.values.length>0){if(meta.values.length>1){_Juice.prototype.debugOutln(i+": ["+meta.values.join(",")+"]")}else{_Juice.prototype.debugOutln(i+": "+meta.values[index==null?0:index])}}else{_Juice.prototype.debugOutln("Meta "+i+": not set")}}};_Juice.prototype.addPanel=function(panel){this._panels[this._panels.length]=panel};_Juice.prototype.debugOutln=function(text){if(this._debugEnabled){if($jq("#JuiceDebug").length==0){$jq("body").append('<div id="JuiceDebug" style="clear: both; z-index: 5000; position: relative; text-align: left; color: #000000; background: #ffffff; font-size: 1.25em;"</div>')}$jq("#JuiceDebug").append(text+"<br/>")}};_Juice.prototype.addToPanel=function(sel){for(var i=0;i<this._panels.length;i++){var panel=this._panels[i];if((sel.defPanel==null&&!panel.shared)||(sel.defPanel!=null&&panel.panelId!=sel.defPanel)){continue}panel.add(sel)}};_Juice.prototype.enableOnPanel=function(sel,pos){for(var i=0;i<this._panels.length;i++){var panel=this._panels[i];if((sel.defPanel==null&&!panel.shared)||(sel.defPanel!=null&&panel.panelId!=sel.defPanel)){continue}panel.enable(sel,pos)}};_Juice.prototype.launchWin=function(uri,type,arg1,arg2){switch(type){case"current":location.href=uri;break;case"overlay":this.launchOverlayWin(arg1,arg2);break;case"iframe":this.launchIframeWin(uri,arg1);break;case"iframe-overlay":var target=this.launchOverlayWin(arg1,arg2);this.launchIframeWin(uri,target);break;case"new":default:this.launchExternalWin(uri);break}};_Juice.prototype.launchOverlayWin=function(content,hdrContent){if(content instanceof JuiceInsert){content=content._container}$jq("body").append('<div id="juiceOverlayMask" class="juiceOverlayMask"></div>');$jq("body").append('<div id="juiceOverlay" class="juiceOverlay" role="dialog" aria-labelledby="juiceovTitle" />');$jq("#juiceOverlay").append('<h2 id="juiceovTitle" class="juiceOverlayTitle" tabindex="0" />'+content);if(hdrContent){$jq("#juiceOverlay h2").append(hdrContent)}$jq("#juiceOverlay h2").append('<a href="javascript:void()" id="juiceovExitClick"><img alt="close lightbox" src="http://talis-rjw.s3.amazonaws.com/PrismDev/close_icon.png" class="juiceovOverlayExitClick" /></a>');var overlayRemove=function(){$jq("#juiceOverlay").remove();$jq("#juiceOverlayMask").remove()};$jq("#juiceovExitClick").click(overlayRemove);$jq(document).keydown(function(e){if(e.keyCode==27){overlayRemove()}})};_Juice.prototype.launchExternalWin=function(uri){if(this.popup_win&&!this.popup_win.closed){this.popup_win.close()}this.popup_win=window.open(uri,"Juice","width="+this.launchWinW+",height="+this.launchWinH+",toolbar=yes,location=yes,directories=yes,status=yes,menubar=yes,scrollbars=yes,copyhistory=yes,resizable=yes");if(window.focus){this.popup_win.focus()}};_Juice.prototype.launchIframeWin=function(uri,insert){var target=insert;if(insert instanceof JuiceInsert){insert.show();target=insert.getInsertObject()}if(target){var frame=document.createElement("iframe");frame.id="juiframe";frame.src=uri;frame.height=target.height();frame.width=target.width();frame.scrolling="auto";target.append(frame)}};_Juice.prototype.runscript=function(id,src){$jq("#"+id).remove();var cont='<script id="'+id+'" src="'+src+'" type="text/javascript"><\/script>';$jq(document).prepend(cont)};_Juice.prototype.ready=_Juice.prototype.onAllLoaded=function(func){var This=this;if(this.isGoogleApiLoaded()&&this.isJsLoaded()){func()}else{setTimeout(function(){This.ready(func)},5)}};_Juice.prototype.loadExtensions=function(){var path=$jq("script[src*=/juice.js]").first().attr("src").replace("/juice.js","/");var args=Array.prototype.slice.call(arguments);args=args.slice(0,args.length);for(var i=0;i<args.length;i++){if(args[i].indexOf(".js")==-1){args[i]=args[i]+".js"}this.loadJs(path+"extensions/"+args[i],"")}};_Juice.prototype.loadJs=function(target,pathPrefix,onLoadEvent){var file=this._absoluteUri(target,pathPrefix);if(this.findJs(file)){if(onLoadEvent){onLoadEvent()}return}this._loadFile(file,"js",onLoadEvent)};_Juice.prototype.loadCss=function(target,pathPrefix){this._loadFile(this._absoluteUri(target,pathPrefix),"css")};_Juice.prototype._loadFile=function(file,type,evnt){if(type=="js"){var This=this;var head=document.getElementsByTagName("head")[0];var ins=document.createElement("script");evnt=evnt||$jq.noop;ins.type="text/javascript";ins.src=file;this.JsLoadFlags[this.JsLoadFlags.length]={name:file,loaded:false};ins.onreadystatechange=function(){if(ins.readyState=="loaded"||ins.readyState=="complete"){evnt();This.jsOnLoadEvent(file)}};ins.onload=function(){evnt();This.jsOnLoadEvent(file)};head.insertBefore(ins,head.firstChild)}else{if(type=="css"){$("head").prepend('<link type="text/css" rel="stylesheet" href="'+file+'" />')}}};_Juice.prototype._absoluteUri=function(file,pathPrefix){if(this._strBeginsWith(file,"http://")||this._strBeginsWith(file,"https://")||this._strBeginsWith(window.location.protocol,"file:")){return file}if(this._strBeginsWith(file,"/")){if(!pathPrefix){pathPrefix=""}else{pathPrefix="/"+pathPrefix}return window.location.protocol+"//"+window.location.host+pathPrefix+file}else{if(!pathPrefix){pathPrefix=""}else{pathPrefix=pathPrefix+"/"}var ret=window.location.protocol+"//"+window.location.host;var path=document.location.pathname;if(this._strEndsWith(path,"/")){path=path.substr(0,path.length-1)}var locationBits=path.split("/");for(var i=0;i<locationBits.length-1;i++){ret+=locationBits[i]+"/"}return ret+pathPrefix+file}};_Juice.prototype.findJs=function(file){var script=$jq("script[src*="+this.urlRoot(file)+"]");if(script.length>0){return true}return false};_Juice.prototype.urlRoot=function(url){if(url.indexOf("#")!=-1){url=url.substring(0,url.indexOf("#"))}if(url.indexOf("?")!=-1){url=url.substring(0,url.indexOf("?"))}return url};_Juice.prototype.jsOnLoadEvent=function(name){var loadFlags=this.JsLoadFlags;for(var i=0;i<loadFlags.length;i++){if(name==loadFlags[i].name){loadFlags[i].loaded=true;break}}};_Juice.prototype.onJsLoaded=function(func){var This=this;if(this.isJsLoaded()){func()}else{setTimeout(function(){This.onJsLoaded(func)},10)}};_Juice.prototype.isJsLoaded=function(){!this.JsNotLoaded().length};_Juice.prototype.JsNotLoaded=function(){var ret=[];var loadFlags=this.JsLoadFlags;for(var i=0;i<loadFlags.length;i++){if(!loadFlags[i].loaded){ret[ret.length]=loadFlags[i].name}}return ret};_Juice.prototype.loadGoogle_jsapi=function(){if(!this._googleLoadFlag){var key=this.googleApiKey;if(key!=""){key="key="+key+"&"}this.loadJs("http://www.google.com/jsapi?"+key,"",function(){juice._googleLoadFlag=true})}};_Juice.prototype.loadGoogleApi=function(api,ver,args){if(!this.googleApiLoaded(api)){this.gapLoadFlags[this.gapLoadFlags.length]={name:api,loaded:false};this._loadGoogleApi(api,ver,args)}};_Juice.prototype._loadGoogleApi=function(api,ver,args){var This=this;this.loadGoogle_jsapi();if(this._googleLoadFlag){google.load(api,ver,{callback:function(){juice.gapOnLoadEvent(api)}})}else{setTimeout(function(){This._loadGoogleApi(api,ver,args)},20)}};_Juice.prototype.gapOnLoadEvent=function(name){var loadFlags=this.gapLoadFlags;for(var i=0;i<loadFlags.length;i++){if(name==loadFlags[i].name){loadFlags[i].loaded=true;break}}};_Juice.prototype.onGoogleApiLoaded=function(func){var This=this;if(this.isGoogleApiLoaded()){func()}else{setTimeout(function(){This.onGoogleApiLoaded(func)},5)}};_Juice.prototype.isGoogleApiLoaded=function(){if(this.googleApiNotLoaded().length){return false}return true};_Juice.prototype.googleApiNotLoaded=function(){var ret=[];var loadFlags=this.gapLoadFlags;for(var i=0;i<loadFlags.length;i++){if(!loadFlags[i].loaded){ret[ret.length]=loadFlags[i].name}}return ret};_Juice.prototype.googleApiLoaded=function(api){var ret=[];var loadFlags=this.gapLoadFlags;for(var i=0;i<loadFlags.length;i++){if(loadFlags[i].name==api){return true}}return false};_Juice.prototype.nums="0123456789";_Juice.prototype.lc="abcdefghijklmnopqrstuvwxyz";_Juice.prototype.uc="ABCDEFGHIJKLMNOPQRSTUVWXYZ";_Juice.prototype.isVal=function(value,val){if(value==""){return true}for(i=0;i<value.length;i++){if(val.indexOf(value.charAt(i),0)==-1){return false}}return true};_Juice.prototype.isnumser=function(value){return $jq.juice.isVal(value,$jq.juice.nums)};_Juice.prototype.isLower=function(value){return $jq.juice.isVal(value,j$jq.juice.lc)};_Juice.prototype.isUpper=function(value){return $jq.juice.isVal(value,$jq.juice.uc)};_Juice.prototype.isAlpha=function(value){return $jq.juice.isVal(value,$jq.juice.lc+$jq.juice.uc)};_Juice.prototype.isAlphanum=function(value){return $jq.juice.isVal(value,$jq.juice.lc+$jq.juice.uc+$jq.juice.nums)};_Juice.prototype.stringToAlphnumAray=function(str){var items=[];var count=0;var raw=$jq.juice.stringToArray(str,",.:;");for(j=0;j<raw.length;j++){if($jq.juice.isAlphanum(raw[j])){items[count++]=raw[j]}}return items};_Juice.prototype.stringToArray=function(str,extras){var seps=" \ts\n\f\r"+extras.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");var replace=new RegExp("["+seps+"]","mg");str.replace(replace," ");return str.split(" ")};_Juice.prototype.toArray=function(data){var items=[];if(!data){return items}else{if($jq.isArray(data)){return data}else{if(typeof data=="string"){items[0]=data}else{if(!data[0]){items[0]=data}else{items=data}}}}return items};_Juice.prototype.updateArray=function(first,second){var ret=first;if(second){for(var i in second){ret[i]=second[i]}}return ret};_Juice.prototype.setCookie=function(name,value,minutes,hours,days,path,domain,secure){var cookie_string=name+"="+escape(value);if(minutes){if(!hours){hours=0}if(!days){days=0}var date=new Date();date.setTime(date.getTime()+((((days*24*60*60)+(hours*60*60)+(minutes*60))*1000)));var expires="; expires="+date.toGMTString();cookie_string+="; expires="+expires.toGMTString()}if(path){cookie_string+="; path="+escape(path)}if(domain){cookie_string+="; domain="+escape(domain)}if(secure){cookie_string+="; secure"}document.cookie=cookie_string};_Juice.prototype.getCookie=function(name){var results=document.cookie.match("(^|;) ?"+name+"=([^;]*)(;|$)");if(results){return(unescape(results[2]))}return null};_Juice.prototype.deleteCookie=function(name){var cookie_date=new Date();cookie_date.setTime(cookie_date.getTime()-1);document.cookie=name+="=; expires="+cookie_date.toGMTString()};_Juice.prototype._strBeginsWith=function(str,target){return(str.match("^"+target)==target)};_Juice.prototype._strEndsWith=function(str,target){return(str.match(target+"$")==target)};window.juice=jQuery.juice=new _Juice();function JuiceInsert(container,insertPoint,insertType){this._container=container;this._insertPoint=insertPoint;this._insertType=insertType;this.shown=[];this.insertObjects=[];this.inserts=$jq(this._insertPoint).length;for(var i=0;i<this.inserts;i++){this.shown[i]=false;this.insertObjects[i]=null}}JuiceInsert.prototype.showAll=function(){for(var i=0;i<this.inserts;i++){this.show(i)}};JuiceInsert.prototype.show=function(pos){pos=pos||0;var This=this;$jq(this._insertPoint).each(function(i){if(i==pos&&!This.shown[i]){var ins=jQuery(This._container);var target=jQuery(this);This.insertObjects[i]=ins;switch(This._insertType){case"after":target.after(ins);break;case"before":target.before(ins);break;case"prepend":target.prepend(ins);break;case"replace":target.replaceWith(ins);break;case"append":default:target.append(ins);break}This.shown[i]=true}})};JuiceInsert.prototype.getInsertObject=function(pos){return this.insertObjects[pos||0]};JuiceInsert.prototype.remove=function(pos){pos=pos||0;if(this.shown[pos]){this.insertObjects[pos].remove();this.insertObjects[pos]=null;this.shown[pos]=false}};window.JuiceInsert=$jq.juice.insert=JuiceInsert;function JuiceProcess(id,initFunc,selectFunc,insert,ju){this._ready=false;if(arguments.length){this.init(id,initFunc,selectFunc,insert,ju)}}JuiceProcess.prototype.initAndStartup=function(id,initFunc,selectFunc,insert,ju){this.init(id,initFunc,selectFunc,insert,ju);this.startup()};JuiceProcess.prototype.init=function(id,initFunc,selectFunc,insert,ju){this.ProcessId=id;this._startFunc=initFunc;this._selectFunc=selectFunc;this._insert=insert;this._juice=ju;this._ready=true};JuiceProcess.prototype.initFunc=function(v){if(v!=null){this._initFunc=v}return this._initFunc};JuiceProcess.prototype.insert=function(v){if(v!=null){this._insert=v}return this._insert};JuiceProcess.prototype.startupWhenReady=function(){if(this._ready){this.startup()}else{var This=this;setTimeout(function(){This.startupWhenReady()},5)}};JuiceProcess.prototype.startup=function(){var This=this;setTimeout(function(){This._startup()},2)};JuiceProcess.prototype._startup=function(){if(this._startFunc){this._startFunc(this)}else{this.enable()}};_JXSPA=[];JuiceProcess.prototype.callbackArrayPos=-1;JuiceProcess.prototype.jsonCallBackPrefix=function(methodName){var ret="_JXSPA["+this.getCallBackPos()+"]";if(methodName){ret+="."+methodName}return encodeURIComponent(ret)};JuiceProcess.prototype.getCallBackPos=function(){if(this.callbackArrayPos==-1){_JXSPA[_JXSPA.length]=this;for(var i=0;i<_JXSPA.length;i++){if(_JXSPA[i]==this){break}}this.callbackArrayPos=i}return this.callbackArrayPos};JuiceProcess.prototype.showInsert=function(pos){if(this._insert){this._insert.show(pos)}};JuiceProcess.prototype.getInsertObjects=function(){return this._insert.insertObjects||[]};JuiceProcess.prototype.getInsertObject=function(pos){return this._insert.getInsertObject(pos)||null};JuiceProcess.prototype.insertCount=function(){return this._insert.inserts||0};JuiceProcess.prototype.enable=function(){};window.JuiceProcess=$jq.juice.process=JuiceProcess;function JuiceSelectProcess(id,iconSrc,selText,initFunc,selectFunc,insert,ju,defPanel){this._ready=false;if(arguments.length){this.init(id,iconSrc,selText,initFunc,selectFunc,insert,ju,defPanel)}}JuiceSelectProcess.prototype=new JuiceProcess();JuiceSelectProcess.prototype.constructor=JuiceSelectProcess;JuiceSelectProcess.superclass=JuiceProcess.prototype;JuiceSelectProcess.prototype.init=function(id,iconSrc,selText,initFunc,selectFunc,insert,ju,defPanel){this.selText=selText;this.iconSrc=iconSrc;this.defPanel=defPanel;JuiceSelectProcess.superclass.init.call(this,id,initFunc,selectFunc,insert,ju);this.addToIconWin();this.startup()};JuiceSelectProcess.prototype.addToIconWin=function(){this._juice.addToPanel(this)};JuiceSelectProcess.prototype.enable=function(pos){this._juice.enableOnPanel(this,pos)};JuiceSelectProcess.prototype.getSelectFunction=function(i){i=i||0;var pos=this.getCallBackPos();return(function(){_JXSPA[pos]._selectFunc[i]})};window.JuiceSelectProcess=$jq.juice.selectProcess=JuiceSelectProcess;function JuicePanel(insertDiv,panelId,startClass,liveClass,showFunc){this.init(insertDiv,panelId,startClass,liveClass,showFunc)}JuicePanel.prototype.init=function(insertDiv,panelId,startClass,liveClass,showFunc){this.liveClass=liveClass;this.startClass=startClass;this.inserted=false;this.shown=false;this.shared=true;this.panelId=panelId;this._insertDiv=insertDiv;this._showFunc=showFunc};JuicePanel.prototype.insert=function(){if(!this.inserted){this._insertDiv.showAll();this.inserted=true}};JuicePanel.prototype.show=function(){if(jQuery.isFunction(this._showFunc)&&!this.shown){this._showFunc();this.shown=true}};JuicePanel.prototype.add=function(sel){this.insert();this.show();var objects=this._insertDiv.insertObjects;for(var i=0;i<objects.length;i++){var id=this.makeId(sel,i);var htm='<img title="'+sel.selText+'" id="'+id+'" class="'+this.startClass+'" src="'+sel.iconSrc+'" />';objects[i].append(htm)}sel.insert(this._insertDiv)};JuicePanel.prototype.enable=function(sel,pos){var func=sel.getSelectFunction(pos);var id=this.makeId(sel,pos);var classes=this.startClass.split(" ");for(var i=0;i<classes.length;i++){$jq("#"+id).removeClass(classes[i])}classes=this.liveClass.split(" ");for(var i=0;i<classes.length;i++){$jq("#"+id).addClass(classes[i])}$jq("#"+id).click(func)};JuicePanel.prototype.makeId=function(sel,pos){pos=pos||0;return this.panelId+"-"+sel.processId+"-"+pos};window.JuicePanel=$jq.juice.panel=JuicePanel})(jQuery,window);